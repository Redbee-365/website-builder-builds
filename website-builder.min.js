var Events=function(){var t={};return{publish:function(){var e=Array.from(arguments),i=e.shift(),n=t[i];if(void 0!==n)for(var o=n.length,s=0;s<o;s++)"function"==typeof t[i][s]&&t[i][s].apply(void 0,e)},subscribe:function(){var e=Array.from(arguments),i=e[0],n=e[1];void 0===t[i]&&(t[i]=[]),t[i].push(n)}}}(),Utils=function(){var t=function(t,e,i){return t/(i/e)};t=function(t,e,i){return t/(i/e)};return{setStyle:function(t,e){for(var i in e)t.style[i]=e[i]},getHeightWidthBasedOnRatio:function(e,i){for(var n=window.innerWidth,o=t(n,e,i),s=0;o<window.innerHeight;)o=t(n+=s,e,i),s++;return{width:n,height:o}},isInRange:function(t,e,i){return i>=t&&i<=e},getFraction:function(t,e,i){return(t-e)/(i-e)*100},cloneObj:function(t){return JSON.parse(JSON.stringify(t))},mergeObj:function(t,e,i){for(var n in e)t.hasOwnProperty(n)&&i||(t[n]=e[n]);return t},getRandomNumber:function(){return parseInt(Math.random()*Math.pow(10,10))},opacityManager:function(t,e){return t.style.display=e<=0?"none":"block",e},getWidth:function(t){var e=document.getElementById("renderingElem");e.innerHTML="";var i=t.cloneNode(1);return i.style.display="block",e.appendChild(i),parseFloat("auto"==getComputedStyle(i).width?0:getComputedStyle(i).width)},getHeight:function(t){var e=document.getElementById("renderingElem");e.innerHTML="";var i=t.cloneNode(1);return i.style.display="block",e.appendChild(i),parseFloat("auto"==getComputedStyle(i).height?0:getComputedStyle(i).height)},isSticky:function(t){return t.classList.contains("sticky")},preloadImages:function(t,e,i){for(var n=[],o=t.length,s=0;s<o;s++)n.push(ImageHandler.loadImages(t[s]));for(var a=[],r=0;r<e.length;r++){var h=e[r]?e[r].frameData:null;a=a.concat(h)}o=Object.keys(a).length;var l=[];for(s=1;s<o;s+=2){var d=a[s]?a[s].url:0;d&&-1==l.indexOf(d)&&(l.push(d),n.push(ImageHandler.loadImages(d)))}Promise.all(n).then(function(){i();var t=2,e=setInterval(function(){var i=Object.keys(a).length;t>i&&clearInterval(e);var n=a[t]?a[t].url:void 0;n&&ImageHandler.newImage(n),t+=2},0)})}}}(),ImageHandler=function(){var t,e={},i=function(t){return e[t]};return{newImage:function(n,o){if(e.hasOwnProperty(n))return"function"==typeof o&&o(i(n),"cache"),i(n);var s,a=document.createElement("img");return t||((s=document.createElement("div")).setAttribute("id","cache-elem"),Utils.setStyle(s,{position:"fixed",top:-1e6,left:-1e6,height:"5000px",width:1e5}),document.body.appendChild(s),t=s),a.onload=function(){!function(t,i){e[t]=i}(n,a),"function"==typeof o&&o(a,"sucess")},a.onerror=function(){"function"==typeof o&&o(a,"failed")},a.src=n,t.appendChild(a),a},loadImages:function(t){return new Promise(function(e,i){var n=ImageHandler.newImage(t);n.onload=function(){e("sucess")},n.onerror=function(){e("failed")}})}}}();!function(){var t=function(t,e){for(var i=[],n=1;n<=e;n++)i.push(t+n);return i},e=function(t,e){this.events={},this.events.preBuilding="object"==typeof e&&"function"==typeof e.preBuilding?e.preBuilding.bind(this):void 0,this.events.onBuilding="object"==typeof e&&"function"==typeof e.onBuilding?e.onBuilding.bind(this):void 0,this.events.postBuilding="object"==typeof e&&"function"==typeof e.postBuilding?e.postBuilding.bind(this):void 0,this.sectionArr=t,this.frameData=[],this.modelFrameMap={}};e.prototype.build=function(e,i){var n=e.startIndex,o=e.endIndex,s=e.freeze,a=(e.path,s?function(e,i){var n=0,o=[],s=0,a=[],r=[],h=[];for(var l in e)"loop"==e[l].type?(n+=e[l].length,o=o.concat(t(parseInt(l)+s+i,e[l].length)),s+=e[l].length,a.push(l),r.push(e[l].path),h.push(e[l].frame)):(n+=e[l],o=o.concat(t(parseInt(l)+s+i,e[l])),s+=e[l]);return{position:o,delta:n,loopCheck:a,loopCount:h,url:r}}(s,n-1):void 0),r=a?a.position:[],h=a?a.delta:0,l=0,d=a?a.loopCheck:-1;void 0===this.startIndex&&(this.startIndex=n),this.endIndex=o;for(var c=n;c<=o;c++){var p=n+l-1;this.frameData[c]={},this.frameData[c].sectionStart=n,this.frameData[c].sectionEnd=o,-1==r.indexOf(c)?l++:this.frameData[c].type="freeze";d.length;for(var u=0;u<d.length;u++)l==d[u]&&(this.frameData[c].type="loop",this.frameData[c].loopPath=a.url[u],this.frameData[c].loopCount=a.loopCount[u]);this.modelFrameMap[p]=c,"function"==typeof this.events.onBuilding&&this.events.onBuilding.apply(void 0,[this.frameData[c],e,l,c])}return i+h},e.prototype.postBuildingProcessor=function(){var t=this.frameData;for(var e in t)"function"==typeof this.events.postBuilding&&this.events.postBuilding.apply(void 0,[t[e],this.modelFrameMap,parseInt(e)])},e.prototype.construct=function(){for(var t=this.sectionArr.length,e=0,i=0;i<t;i++){var n=this.sectionArr[i];"function"==typeof this.events.preBuilding&&this.events.preBuilding.apply(void 0,[n]),this.build(n,e),e=n.endIndex}this.size=Object.keys(this.frameData).length,this.postBuildingProcessor()},window.ModelBuilder=e}(),function(){var t=function(t,e,i,n,o,s,a){this.canvasAllowedStyles=["height","width","padding","paddingTop","paddingRight","paddingBottom","paddingLeft","border","borderTop","borderRight","borderBottom","borderLeft","transform"],this.idElemMap={},this.contentArray=this.setProperties(s._textModelArr),this.frameCount=t,this.canvasElem=i.element,this.context=this.canvasElem.getContext("2d"),this.canvasWidth=i.width,this.canvasHeight=i.height,this.textElem=n,this.sectionData=o,this.sectionElem=o.node,this.model=s,this.events={},this.events.customTextEffects="object"==typeof a&&"function"==typeof a.customTextEffects?a.customTextEffects.bind(this):void 0,this.canBuild=!1,this.externalHeader=this.sectionElem.querySelector("#header"),this.internalHeader=this.sectionElem.querySelector("#internalHeader"),this.loopInterval,this.startIndex=0,this.endIndex=this.sectionData.offsetTop+parseInt(o.height),this.scrollTop=document.body.scrollTop-this.sectionData.offsetTop,this.extHeaderTopRect=this.externalHeader&&this.externalHeader.getBoundingClientRect(),this.intHeaderTopRect=this.internalHeader&&this.internalHeader.getBoundingClientRect(),this.externalHeaderDeviation=this.externalHeader&&!Utils.isSticky(this.externalHeader)?parseInt(getComputedStyle(this.externalHeader).height):0,this.internalHeaderDeviation=this.internalHeader?parseInt(getComputedStyle(this.internalHeader).height)+this.scrollTop+this.intHeaderTopRect.top:0,this.netHeaderDeviation=this.externalHeaderDeviation+this.internalHeaderDeviation,this.boundScrollEvent=this.animate.bind(this)};t.prototype.render=function(t){t?(window.addEventListener("scroll",this.boundScrollEvent),this.build(0),this.animate(window.scrollTop)):window.removeEventListener("scroll",this.boundScrollEvent)},t.prototype.animate=function(t){"object"!=typeof t&&window.scrollTo(0,parseInt(t));var e=document.body.scrollTop;if(this.sectionData.offsetTop>e)this.hideTextlayer();else{this.showTextlayer(),this.scrollTop=Math.ceil(e-this.sectionData.offsetTop);var i,n=this.internalHeader&&this.internalHeader.getBoundingClientRect(),o=this.externalHeader&&this.externalHeader.getBoundingClientRect(),s=this.netHeaderDeviation;this.internalHeader?s-=(i=n.bottom)>0?i:0:this.externalHeader&&!Utils.isSticky(this.externalHeader)&&(s-=(i=o.bottom)>0?i:0),s=parseInt(s);var a=this.sectionElem.querySelector("#footer"),r=a?parseInt(getComputedStyle(a).height):0,h=this.sectionData.offsetHeight-s-r-(this.sectionData.offsetHeight>window.innerHeight?window.innerHeight:0),l=(this.scrollTop-s)/h,d=Math.min(this.frameCount-1,Math.ceil(l*this.frameCount));this.clearDirtyNodes(d),(void 0===i||i<0)&&this.build(d)}},t.prototype.setProperties=function(t){for(var e=0;e<t.length;e++){var i=t[e].id;t[e].style||(t[e].style={});var n=document.createElement("div");n.innerHTML=t[e].innerHTML,Utils.setStyle(n,t[e].style),t[e].style.width=Utils.getWidth(n),t[e].style.height=Utils.getHeight(n),this.idElemMap[i]=t[e]}return t},t.prototype.getElementById=function(t){var e=this.textElem.querySelector("#"+t);return e||((e=document.createElement("div")).setAttribute("id",t),e.classList.add("overlay-text-element"),e.style.position="fixed",this.textElem.appendChild(e)),e},t.prototype.hideLayer=function(t){var e=this.getElementById(t.id);Utils.setStyle(e,{opacity:Utils.opacityManager(e,0)})},t.prototype.setPositioning=function(t,e,i,n){var o=t["v-pos"],s=t["h-pos"],a=window.innerWidth,r=window.innerHeight,h=n?n.deltaWidth:0;switch(o){case"top":i-=r/4;break;case"upper_middle":i-=r/16;break;case"middle":break;case"lower_middle":i+=r/16;break;case"bottom":i+=r/4}switch(s){case"left":e-=a/4-h/2;break;case"center":e+=h/2;break;case"right":e+=a/4+h/2}return{xAxis:e,yAxis:i}},t.prototype.updateTextLayer=function(t,e,i){var n=e.innerHTML?e.innerHTML:"",o=e.style,s=e.transitionDir,a=e.position,r={},h=this.getElementById(e.id);h.innerHTML=n;var l=this.idElemMap[e.id].style.width,d=this.idElemMap[e.id].style.height,c=window.innerWidth,p=window.innerHeight,u=c/2-l/2,f=p/2-d/2;if("r2l"==s){if((u=Math.min(c-l/2*t,c))>c-l)return void(h.style.opacity=Utils.opacityManager(h,0));u<c/4&&(u=c/4-t)}else"b2t"==s?(u=c/2-l/2,f=p/2-t):r="function"==typeof this.events.customTextEffects?this.events.customTextEffects(s,h,t,f,u):{};if(a){var m=this.setPositioning(a,u,f,i);u=m.xAxis,f=m.yAxis}else{u+=(i?i.deltaWidth:0)/2}var g=Utils.cloneObj(o);delete g.width,delete g.height,Utils.setStyle(h,g),u=r.xAxis?r.xAxis:u,f=r.yAxis?r.yAxis:f,h.style.transform="matrix(1,0,0,1,"+u+","+f+")";var y=0;t<=14?y=t/100*2:t>14&&t<=86?y=1:t>86&&(y=2-2*t/100),y=r.opacity?r.opacity:y,h.style.opacity=Utils.opacityManager(h,y<.1?.1:y)},t.prototype.applyCanvasProp=function(t){void 0!==t?t.width:this.canvasWidth,void 0!==t?t.height:this.canvasHeight;if(void 0===t||void 0===t.width&&void 0===t.height)this.sectionElem.style.left="",this.canvasElem.style.maxWidth="",this.canvasElem.style.maxHeight="";else{var e=t.deltaWidth?t.deltaWidth:0;this.sectionElem.style.left=e>0?-Math.abs(e/2):"",this.canvasElem.style.maxWidth="unset",this.canvasElem.style.maxHeight="unset"}for(var i={},n=0;n<this.canvasAllowedStyles.length;n++){var o=this.canvasAllowedStyles[n],s=t?t[o]:t;i[o]=void 0!==s?s:""}i.transition="width 3s, height 3s",Utils.setStyle(this.canvasElem,i)},t.prototype.updateImage=function(t){var e=t.canvasProp,i=function(t){this.applyCanvasProp(e),this.context&&this.context.drawImage(t,0,0,this.canvasWidth,this.canvasHeight)}.bind(this);ImageHandler.newImage(t.url,i)},t.prototype.loopImage=function(t){if(!this.loopInterval){this.gifferValue=0;var e=t.canvasProp;this.applyCanvasProp(e),this.loopInterval=setInterval(function(){var e=this.gifferValue%t.loopCount,i=ImageHandler.newImage(getImageUrl(e+1,t.loopPath));this.context&&this.context.drawImage(i,0,0,this.canvasWidth,this.canvasHeight),this.gifferValue++}.bind(this),50)}},t.prototype.hideTextlayer=function(){this.textElem.style.display="none"},t.prototype.showTextlayer=function(){this.textElem.style.display="block"},t.prototype.clearDirtyNodes=function(t){for(var e=Array.from(this.textElem.querySelectorAll(".overlay-text-element")),i=0;i<e.length;i++){var n=e[i],o=n.id,s=this.idElemMap[o];s.isInRange(t+1)?(n.classList.remove("notInRange"),n.classList.add("inRange")):(this.hideLayer(s),n.classList.remove("inRange"),n.classList.add("notInRange"))}},t.prototype.build=function(t){if(t<this.frameCount){var e=this.model.frameData[t+1];"loop"==e.type?this.loopImage(e):(clearInterval(this.loopInterval),this.loopInterval=void 0,requestAnimationFrame(function(){this.updateImage(e)}.bind(this)));for(var i=e.text,n=e.canvasProp,o=0;o<i.length;o++)this.updateTextLayer(i[o].fraction,i[o],n)}},t.prototype.destroy=function(){return this.render(!1)},window.Animator=t}(),function(){var t=function(t,e){var i={},n={},o=t.sections[e].ui,s=t.sections[e].text||[],a=o.innerElem.querySelector("#text-layer"),r=t.model[e],h=r.size;if(i.element=o.innerElem.querySelector("canvas"),i.height=o.canvasProp.style.height,i.width=o.canvasProp.style.width,"cover"==o.canvasProp.fit){var l=parseInt(i.height),d=parseInt(i.width);i.width=Utils.getHeightWidthBasedOnRatio(l,d).width,i.height=Utils.getHeightWidthBasedOnRatio(l,d).height,i.element.style.maxWidth="unset",i.element.style.maxHeight="unset"}return i.element.width=i.width,i.element.height=i.height,n.node=o.innerElem,n.height=parseInt(o.outerStyle.height),n.offsetTop=o.offsetTop+o.deltaHeight/2,n.offsetHeight=o.offsetBottom-n.offsetTop,n.deltaWidth=o.deltaWidth,[h,s,i,a,n,r,{customTextEffects:t.customTextEffects}]},e=function(t,e,i,n){this.container=t,this.sectionDataObj=e,this.topSpacing=this.sectionDataObj.topSpacing?this.sectionDataObj.topSpacing:0,this.header=this.sectionDataObj.header,this.sections=this.sectionDataObj.body,this.sectionLength=this.sections.length,this.model=[],this.animator=[],this.animatorObj=n||{},this.customTextEffects=this.animatorObj.customTextEffects,this.heightPerFrame=void 0!==this.animatorObj.heightPerFrame?this.animatorObj.heightPerFrame:14e3/436,this.getSectionElem=i,this.modelInit(),this.uiInit(),this.boundScrollEvent=this.scrollEvent.bind(this),window.addEventListener("scroll",this.boundScrollEvent)};e.prototype.scrollEvent=function(){var t=document.body.scrollTop,e=this.getElementsInRange(t);if(1==e.length){var i=e[0].section,n=this.outerContainer.node,o=i.ui.offsetPosition;n.style.top=0!=o?-Math.abs(o):0}else if(e.length>1){var s=e[0],a=e[1],r=s.section,h=a.section,l=s.model,d=a.model,c=l?l.endIndex:0,p=d?d.startIndex:0,u=l?l.frameData:null,f=d?d.frameData:null;s.animator&&s.animator.updateImage(u[c]),a.animator&&a.animator.updateImage(f[p]);var m=r.ui.offsetBottom-t-h.ui.offsetPosition;(n=this.outerContainer.node).style.top=m}},e.prototype.isInRange=function(t,e){var i=window.innerHeight,n=e.offsetTop,o=e.offsetBottom,s=t+i;return!(n>s&&o>s||n<t&&o<t)},e.prototype.getElementsInRange=function(t){for(var e=[],i=this.sections.length,n=0;n<i;n++)this.isInRange(t,this.sections[n].ui)&&(e.push({section:this.sections[n],model:this.model[n],animator:this.animator[n]}),e.length);return e},e.prototype.isStatic=function(t){return"static"==t},e.prototype.animatorInit=function(){for(var e=this.sections.length,i=0;i<e;i++)this.isStatic(this.sections[i].ui.type)?this.animator[i]=null:(this.animator[i]=new(Function.prototype.bind.apply(Animator,[void 0].concat(t(this,i)))),this.animator[i].render(!0))},e.prototype.modelInit=function(){for(var t=this.sections.length,e=0;e<t;e++){var i=this.sections[e];this.isStatic(i.ui.type)?this.model[e]=null:(this.model[e]=new ModelBuilder([i],{preBuilding:function(){this._preBuildModel.apply(this,Array.from(arguments))},onBuilding:function(){this._setUpModel.apply(this,Array.from(arguments))},postBuilding:function(){this._postBuildModel.apply(this,Array.from(arguments))}}),this.model[e]._init(i.ui.canvasProp?i.ui.canvasProp.styleAtIndex:0),this.model[e].construct())}},e.prototype.handleHeader=function(){if(this.topSpacing){var t=document.createElement("div");t.style.height=this.topSpacing,this.container.appendChild(t)}if(this.header){this.headerElem=document.createElement("div"),this.headerElem.innerHTML=this.header.innerHTML,Utils.setStyle(this.headerElem,{position:this.header.style.position,top:this.header.style.top,zIndex:4});var e=this.headerElem.children[0];this.container.appendChild(this.headerElem),this.headerDelta=2*(parseInt(getComputedStyle(e).height)+document.body.scrollTop+e.getBoundingClientRect().top)}};var i=function(t,e,i){var n={};if(t&&"cover"==t.fit){var o=t.style.width,s=t.style.height,a=Utils.getHeightWidthBasedOnRatio(s,o);n.deltaHeight=a.height-e,n.deltaWidth=a.width-i,n.maxHeight=a.height,n.maxWidth=a.width}return n};e.prototype.uiInit=function(){this.handleHeader();var t=this.sections.length,e=document.createElement("div");this.outerContainer={},this.outerContainer.style={height:0,width:window.innerWidth},this.outerContainer.node=e;for(var n=this.outerContainer.style,o=0,s=this.headerDelta,a=0,r=0;r<t;r++){var h=this.sections[r].ui,l=h.outerStyle={height:0,width:0},d=null!=this.model[r]?this.model[r].size:0,c=h.canvasProp,p=this.getSectionElem(h),u=h.id,f=window.innerWidth,m=window.innerHeight-this.topSpacing,g=0,y=0;if("static"==h.type){var v=this.sections[r+1]&&this.sections[r+1].ui.canvasProp,w=i(v,window.innerHeight,window.innerWidth).deltaHeight;l.height=window.innerHeight+(w?w/2:0)+a/2}else l.height=d*this.heightPerFrame;var I=i(c,m,f);g=I.deltaHeight?I.deltaHeight:g,y=I.deltaWidth?I.deltaWidth:y,m=I.maxHeight?I.maxHeight:m,f=I.maxWidth?I.maxWidth:f,u||(h.id=u=Utils.getRandomNumber()),h.deltaHeight=g+s,h.deltaWidth=y,h.offsetTop=n.height-g/2,h.offsetPosition=o+g/2,n.height+=parseInt(l.height),h.offsetBottom=h.offsetTop+parseInt(l.height)+g,s+=g,h.innerElem=p,p.setAttribute("id","section_"+u),p.style.width=f,p.style.height=m,p.style.position="relative",Utils.setStyle(p,this.sections[r].style),o+=parseInt(p.style.height),e.appendChild(p),a=g}Utils.setStyle(e,{position:"fixed",zIndex:1}),Utils.setStyle(this.container,n),this.container.appendChild(e)},e.prototype.init=function(){this.animatorInit()},e.prototype.revertStyle=function(){this.container.style.width="",this.container.style.height=""},e.prototype.destroy=function(){for(var t=this.animator.length,e=0;e<t;e++)null!=this.animator[e]&&this.animator[e].destroy();window.removeEventListener("scroll",this.boundScrollEvent),this.revertStyle()},window.SectionHandler=e}(),function(){var t=function(t,e){this.container=t?t.container:e.container,this.staticSec=t?t.body:null,this.content={header:e.header,body:e.body},this.beforeInit=e.beforeInit,this.afterInit=e.afterInit,this.onScroll="function"==typeof e.onScroll?e.onScroll:function(){},this.getElem=e.getElement,this.networkLatency=0,this.effects=e.customEffects,this.isInitialised=!1,this.secHandler,this.heightPerFrame=e.heightPerFrame,this.sections=this.content.body,this.boundOnResize=this.onResize.bind(this)};t.prototype.beforeModelInit=function(){"function"==typeof this.beforeInit?this.beforeInit(this.secHandler.model,function(){this.modelInit()}.bind(this)):this.modelInit()},t.prototype.modelInit=function(){this.secHandler.init.apply(this.secHandler),this.afterModelInit()},t.prototype.afterModelInit=function(){"function"==typeof this.afterInit&&this.afterInit()},t.prototype.loadStatic=function(){null!=this.staticSec?this.container.innerHTML=this.staticSec.innerHTML:this.loadDynamic()},t.prototype.loadDynamic=function(){this.secHandler=new SectionHandler(this.container,this.content,this.getElem,{customTextEffects:this.effects,heightPerFrame:this.heightPerFrame}),this.beforeModelInit(),window.addEventListener("scroll",this.onScroll),window.addEventListener("resize",this.boundOnResize)},t.prototype.onResize=function(){null!=this.staticSec&&(this.secHandler.destroy(),this.loadStatic(),window.removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.boundOnResize))},t.prototype.networklatency=function(){impUtils.networkLatencyFunc(function(t){this.networkLatency=t,this.loadDynamic()}.bind(this))},t.prototype.build=function(){this.networklatency()},window.WebsiteBuilder=t}();